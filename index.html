<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zanari - Ekskluzywne Torebki z Drewna</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cinzel+Decorative:wght@400&family=Cormorant+Garamond:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ... (pozostałe style bez zmian) ... */
    </style>
</head>
<body>
    <!-- Strona główna -->
    <div id="main-page">
        <!-- ... (pozostała zawartość bez zmian) ... -->
    </div>

    <!-- Strona z podziękowaniami -->
    <div id="thank-you-page" class="thank-you-page">
        <!-- ... (bez zmian) ... -->
    </div>

    <div id="imageModal" class="modal">
        <!-- ... (bez zmian) ... -->
    </div>

    <div id="contactModal" class="contact-modal">
        <div class="contact-modal-content">
            <span class="contact-close" onclick="closeContactModal()">&times;</span>
            <h2>Wyślij wiadomość</h2>
            <form class="contact-form" id="contactForm" action="https://formsubmit.co/zanariwood@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="Nowa wiadomość ze strony Zanari">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">
                <input type="hidden" name="_next" value="" id="contact-next">
                <!-- DODANE: ukryte pole z linkiem do produktu -->
                <input type="hidden" name="product_link" id="contact-product-link" value="">
                <input type="text" name="name" placeholder="Imię" required>
                <input type="email" name="email" placeholder="Email" required>
                <textarea name="message" placeholder="Wiadomość" required></textarea>
                <button type="submit">Wyślij</button>
            </form>
            <div class="contact-info">
                <p>Telefon: +48 600 658 728</p>
                <p>Social media: 
                    <a href="https://www.instagram.com/zanariwood/" class="social-link" id="contact-instagram">Instagram</a> | 
                    <a href="https://www.facebook.com/profile.php?id=61582568185533" class="social-link" id="contact-facebook">Facebook</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Modal zamówienia -->
    <div id="orderModal" class="order-modal">
        <div class="order-modal-content">
            <span class="order-close" onclick="closeOrderModal()">&times;</span>
            <h2>Składanie zamówienia / pytania</h2>
            <form class="order-form" id="orderForm" action="https://formsubmit.co/zanariwood@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="Zapytanie o dostępność produktu - Zanari">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">
                <input type="hidden" name="_next" value="" id="order-next">
                <!-- DODANE: ukryte pole z linkiem do produktu -->
                <input type="hidden" name="product_link" id="order-product-link" value="">
                
                <label for="product-name">Produkt:</label>
                <input type="text" id="product-name" name="product" readonly>

                <label for="contact-email">Email kontaktowy *</label>
                <input type="email" id="contact-email" name="email" placeholder="Twój adres email" required>

                <label for="contact-phone">Numer telefonu (opcjonalnie)</label>
                <input type="tel" id="contact-phone" name="phone" placeholder="Twój numer telefonu">

                <label for="order-message">Wiadomość:</label>
                <textarea id="order-message" name="message" placeholder="Twoja wiadomość..." required></textarea>
                <p class="form-note">Prosimy o informację dotyczącą dostępności produktu oraz wszelkie dodatkowe pytania lub uwagi.</p>

                <button type="submit">Wyślij</button>
            </form>
        </div>
    </div>

    <!-- Modal outlet -->
    <div id="outletModal" class="outlet-modal">
        <div class="outlet-modal-content">
            <span class="outlet-close" onclick="closeOutletModal()">&times;</span>
            <h2>Outlet - pytania</h2>
            <form class="outlet-form" id="outletForm" action="https://formsubmit.co/zanariwood@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="Zapytanie o produkt w outlecie - Zanari">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_template" value="table">
                <input type="hidden" name="_next" value="" id="outlet-next">
                <!-- DODANE: ukryte pole z linkiem do produktu -->
                <input type="hidden" name="product_link" id="outlet-product-link" value="">
                
                <label for="outlet-product-name">Produkt:</label>
                <input type="text" id="outlet-product-name" name="product" readonly>

                <label for="outlet-email">Email kontaktowy *</label>
                <input type="email" id="outlet-email" name="email" placeholder="Twój adres email" required>

                <label for="outlet-phone">Numer telefonu (opcjonalnie)</label>
                <input type="tel" id="outlet-phone" name="phone" placeholder="Twój numer telefonu">

                <label for="outlet-message">Wiadomość:</label>
                <textarea id="outlet-message" name="message" placeholder="Chciałbym/chciałabym otrzymać zdjęcia produktu oraz informacje o stanie tego produktu dostępnego w outlecie." required></textarea>

                <button type="submit">Wyślij zapytanie</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== OBSŁUGA FORMULARZY ====================

        // Funkcja do ustawiania pełnego URL dla parametru _next
        function setNextUrls() {
            const baseUrl = window.location.href.split('#')[0];
            const thankYouUrl = baseUrl + '#thank-you-page';
            
            document.getElementById('contact-next').value = thankYouUrl;
            document.getElementById('order-next').value = thankYouUrl;
            document.getElementById('outlet-next').value = thankYouUrl;
        }

        // Funkcja do generowania linku do produktu
        function generateProductLink(productName, productId = null) {
            const baseUrl = window.location.href.split('#')[0];
            let productLink = baseUrl + '#kolekcja';
            
            // Jeśli mamy ID produktu, dodajemy je do linku
            if (productId) {
                productLink += `-product-${productId}`;
            }
            
            // Dodajemy nazwę produktu jako parametr URL
            const encodedName = encodeURIComponent(productName);
            productLink += `?product=${encodedName}`;
            
            return productLink;
        }

        // Funkcja do pobierania ID produktu z elementu
        function getProductId(element) {
            const item = element.closest('.item');
            if (item) {
                const productIdElement = item.querySelector('.product-id');
                if (productIdElement) {
                    return productIdElement.textContent.trim();
                }
            }
            return null;
        }

        // Funkcja do pokazania strony z podziękowaniami
        function showThankYouPage() {
            document.getElementById('main-page').style.display = 'none';
            document.getElementById('thank-you-page').style.display = 'block';
            window.scrollTo(0, 0);
        }

        // Funkcja do powrotu do strony głównej
        function showMainPage() {
            document.getElementById('thank-you-page').style.display = 'none';
            document.getElementById('main-page').style.display = 'block';
            window.scrollTo(0, 0);
            // Usuwamy hash z URL
            history.replaceState(null, null, ' ');
        }

        // Sprawdź hash przy załadowaniu strony
        window.addEventListener('load', function() {
            setNextUrls(); // Ustaw pełne URL dla formularzy
            if (window.location.hash === '#thank-you-page') {
                showThankYouPage();
            }
        });

        // ==================== FUNKCJE OUTLET ====================

        function openOutletModal(productName, element = null) {
            const outletModal = document.getElementById('outletModal');
            const productNameInput = document.getElementById('outlet-product-name');
            const outletMessage = document.getElementById('outlet-message');
            const productLinkInput = document.getElementById('outlet-product-link');

            if (outletModal && productNameInput && productLinkInput) {
                // Pobierz ID produktu jeśli element jest przekazany
                const productId = element ? getProductId(element) : null;
                
                // Generuj link do produktu
                const productLink = generateProductLink(productName, productId);
                productLinkInput.value = productLink;

                // Znajdź cenę produktu tylko jeśli przycisk outlet jest aktywny
                let priceInfo = '';
                const items = document.querySelectorAll('.item');
                
                for (let item of items) {
                    const itemName = item.querySelector('h3').textContent;
                    if (itemName === productName) {
                        const outletBtn = item.querySelector('.btn-outlet');
                        // Sprawdź czy przycisk outlet jest aktywny (nie ma disabled)
                        if (outletBtn && !outletBtn.disabled) {
                            const priceText = item.querySelector('strong').textContent;
                            const originalPrice = parseFloat(priceText.replace(/[^\d,]/g, '').replace(',', '.'));
                            if (!isNaN(originalPrice)) {
                                const discountedPrice = (originalPrice * 0.7).toFixed(0);
                                priceInfo = `\n\nCena outlet: ${discountedPrice} zł (obniżka 30% z ceny ${originalPrice} zł)`;
                            }
                        }
                        break;
                    }
                }
                
                productNameInput.value = productName;
                outletMessage.value = `Chciałbym/chciałabym otrzymać zdjęcia produktu "${productName}" oraz informacje o stanie tego produktu dostępnego w outlecie.${priceInfo}\n\nLink do produktu: ${productLink}`;
                outletModal.style.display = 'block';
            }
        }

        function closeOutletModal() {
            const outletModal = document.getElementById('outletModal');
            if (outletModal) outletModal.style.display = 'none';
        }

        // ==================== POZOSTAŁE FUNKCJE ====================

        const videos = [
            { video: document.getElementById('video-1'), button: document.getElementById('speaker-btn-1'), icon: document.getElementById('speaker-icon-1') },
            { video: document.getElementById('video-2'), button: document.getElementById('speaker-btn-2'), icon: document.getElementById('speaker-icon-2') },
            { video: document.getElementById('video-3'), button: document.getElementById('speaker-btn-3'), icon: document.getElementById('speaker-icon-3') },
            { video: document.getElementById('video-4'), button: document.getElementById('speaker-btn-4'), icon: document.getElementById('speaker-icon-4') },
            { video: document.getElementById('video-5'), button: document.getElementById('speaker-btn-5'), icon: document.getElementById('speaker-icon-5') },
            { video: document.getElementById('video-6'), button: document.getElementById('speaker-btn-6'), icon: document.getElementById('speaker-icon-6') },
            { video: document.getElementById('video-7'), button: document.getElementById('speaker-btn-7'), icon: document.getElementById('speaker-icon-7') },
            { video: document.getElementById('video-8'), button: document.getElementById('speaker-btn-8'), icon: document.getElementById('speaker-icon-8') },
            { video: document.getElementById('video-9'), button: document.getElementById('speaker-btn-9'), icon: document.getElementById('speaker-icon-9') }
        ];

        let currentVideoIndex = 0;

        function playNextVideo() {
            videos[currentVideoIndex].video.classList.remove('active');
            videos[currentVideoIndex].button.style.display = 'none';
            currentVideoIndex = (currentVideoIndex + 1) % videos.length;
            videos[currentVideoIndex].video.classList.add('active');
            videos[currentVideoIndex].button.style.display = 'block';
            videos[currentVideoIndex].video.play();
            videos[currentVideoIndex].video.muted = true;
            videos[currentVideoIndex].icon.src = 'ikony/speaker-off.png';
            videos[currentVideoIndex].icon.alt = 'Włącz dźwięk';
        }

        videos.forEach((videoObj, index) => {
            videoObj.video.addEventListener('ended', playNextVideo);
        });

        function toggleMute(index) {
            const videoObj = videos[index - 1];
            videoObj.video.muted = !videoObj.video.muted;
            if (videoObj.video.muted) {
                videoObj.icon.src = 'ikony/speaker-off.png';
                videoObj.icon.alt = 'Włącz dźwięk';
            } else {
                videoObj.icon.src = 'ikony/speaker-on.png';
                videoObj.icon.alt = 'Wyłącz dźwięk';
            }
        }

        let slideIndex = 0;
        let currentImages = [];

        // Funkcja do sprawdzania czy obrazek istnieje
        function imageExists(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = url;
            });
        }

        // Funkcja do ładowania dodatkowych zdjęć (do litery f)
        async function loadAdditionalImages() {
            const items = document.querySelectorAll('.item');

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const additionalContainer = item.querySelector('.additional-images');
                const baseImageSrc = item.querySelector('.item-images img').src;

                // Pobierz bazową nazwę pliku (bez rozszerzenia i ostatniej litery)
                const basePath = baseImageSrc.substring(0, baseImageSrc.lastIndexOf('.'));
                const baseName = basePath.substring(0, basePath.length - 1); // Usuń ostatnią literę (a/b)

                // Lista możliwych dodatkowych zdjęć (c, d, e, f)
                const additionalLetters = ['c', 'd', 'e', 'f'];
                let existingImages = [];

                // Sprawdź które zdjęcia istnieją
                for (const letter of additionalLetters) {
                    const imageUrl = baseName + letter + '.jpg';
                    const exists = await imageExists(imageUrl);
                    if (exists) {
                        existingImages.push({ url: imageUrl, letter: letter });
                    }
                }

                // Dodaj tylko te zdjęcia które istnieją
                for (const imgData of existingImages) {
                    const imgElement = document.createElement('img');
                    imgElement.src = imgData.url;
                    imgElement.alt = additionalContainer.previousElementSibling.querySelector('img').alt.replace('widok 1', `widok ${imgData.letter.toUpperCase()}`).replace('widok 2', `widok ${imgData.letter.toUpperCase()}`);
                    imgElement.onclick = function() { openModal(this); };
                    additionalContainer.appendChild(imgElement);
                }

                // Jeśli nie ma żadnych dodatkowych zdjęć, ukryj kontener
                if (existingImages.length === 0) {
                    additionalContainer.style.display = 'none';
                }
            }
        }

        function openModal(img) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            if (!modal || !modalImg) return;
            modal.style.display = 'flex';
            modalImg.src = img.src;

            if (img.src.includes('logo.png')) {
                currentImages = [document.querySelector('.logo img')];
                slideIndex = 0;
            } else if (img.src.includes('proces_rzemieslniczy1.png')) {
                currentImages = [document.querySelector('.craftsmanship img')];
                slideIndex = 0;
            } else {
                const item = img.closest('.item');
                if (item) {
                    const allImages = Array.from(item.querySelectorAll('.item-images img, .additional-images img'));
                    currentImages = allImages;
                    slideIndex = currentImages.indexOf(img);
                } else {
                    currentImages = [img];
                    slideIndex = 0;
                }
            }
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            if (modal) modal.style.display = 'none';
            currentImages = [];
            slideIndex = 0;
        }

        function plusSlides(n) {
            slideIndex += n;
            if (slideIndex >= currentImages.length) { slideIndex = 0; }
            if (slideIndex < 0) { slideIndex = currentImages.length - 1; }
            const modalImg = document.getElementById('modalImage');
            if (modalImg && currentImages[slideIndex]) {
                modalImg.src = currentImages[slideIndex].src;
            }
        }

        // Funkcje dla modala zamówienia
        function openOrderModal(productName, element = null) {
            const orderModal = document.getElementById('orderModal');
            const productNameInput = document.getElementById('product-name');
            const orderMessage = document.getElementById('order-message');
            const productLinkInput = document.getElementById('order-product-link');

            if (orderModal && productNameInput && productLinkInput) {
                // Pobierz ID produktu jeśli element jest przekazany
                const productId = element ? getProductId(element) : null;
                
                // Generuj link do produktu
                const productLink = generateProductLink(productName, productId);
                productLinkInput.value = productLink;

                productNameInput.value = productName;
                orderMessage.value = `Chciałbym/chciałabym zapytać o dostępność produktu "${productName}".\n\nLink do produktu: ${productLink}`;
                orderModal.style.display = 'block';
            }
        }

        function closeOrderModal() {
            const orderModal = document.getElementById('orderModal');
            if (orderModal) orderModal.style.display = 'none';
        }

        // Funkcja do aktualizacji linków społecznościowych
        function updateSocialLinks(instagramUrl = "https://www.instagram.com/zanariwood/", facebookUrl = "https://www.facebook.com/profile.php?id=61582568185533") {
            // Linki w sekcji kontakt na głównej stronie
            document.getElementById('main-instagram').href = instagramUrl;
            document.getElementById('main-facebook').href = facebookUrl;

            // Linki w footerze
            document.getElementById('footer-instagram').href = instagramUrl;
            document.getElementById('footer-facebook').href = facebookUrl;

            // Linki w modal kontaktowy
            document.getElementById('contact-instagram').href = instagramUrl;
            document.getElementById('contact-facebook').href = facebookUrl;
        }

        // Funkcja do powiększania/zmniejszania obrazka procesu rzemieślniczego
        function toggleZoom(img) {
            img.classList.toggle('zoomed');

            if (img.classList.contains('zoomed')) {
                // Blokujemy scrollowanie strony gdy obrazek jest powiększony
                document.body.style.overflow = 'hidden';
                // Dodajemy możliwość zamknięcia przez dotknięcie gdziekolwiek
                setTimeout(() => {
                    document.addEventListener('click', closeZoomOnClick);
                }, 100);
            } else {
                // Przywracamy scrollowanie
                document.body.style.overflow = 'auto';
                // Usuwamy listener
                document.removeEventListener('click', closeZoomOnClick);
            }
        }

        function closeZoomOnClick(event) {
            const craftsmanshipImg = document.querySelector('.craftsmanship img.zoomed');
            if (craftsmanshipImg && !craftsmanshipImg.contains(event.target)) {
                craftsmanshipImg.classList.remove('zoomed');
                document.body.style.overflow = 'auto';
                document.removeEventListener('click', closeZoomOnClick);
            }
        }

        // Zamykanie powiększonego obrazka klawiszem ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const craftsmanshipImg = document.querySelector('.craftsmanship img.zoomed');
                if (craftsmanshipImg) {
                    craftsmanshipImg.classList.remove('zoomed');
                    document.body.style.overflow = 'auto';
                    document.removeEventListener('click', closeZoomOnClick);
                }

                const orderModal = document.getElementById('orderModal');
                if (orderModal && orderModal.style.display === 'block') {
                    closeOrderModal();
                }

                const outletModal = document.getElementById('outletModal');
                if (outletModal && outletModal.style.display === 'block') {
                    closeOutletModal();
                }
            }
        });

        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            const contactModal = document.getElementById('contactModal');
            const orderModal = document.getElementById('orderModal');
            const outletModal = document.getElementById('outletModal');

            if (event.target == modal) {
                closeModal();
            }
            if (event.target == contactModal) {
                contactModal.style.display = 'none';
            }
            if (event.target == orderModal) {
                orderModal.style.display = 'none';
            }
            if (event.target == outletModal) {
                outletModal.style.display = 'none';
            }
        }

        function openContactModal() {
            const contactModal = document.getElementById('contactModal');
            const productLinkInput = document.getElementById('contact-product-link');
            
            if (contactModal && productLinkInput) {
                // Dla formularza kontaktowego ustawiamy ogólny link do strony
                productLinkInput.value = window.location.href;
                contactModal.style.display = 'block';
            }
        }

        function closeContactModal() {
            const contactModal = document.getElementById('contactModal');
            if (contactModal) contactModal.style.display = 'none';
        }

        // Załaduj dodatkowe zdjęcia i ustaw linki społecznościowe po załadowaniu strony
        document.addEventListener('DOMContentLoaded', function() {
            loadAdditionalImages();
            setNextUrls(); // Ustaw pełne URL dla formularzy

            // Ustaw linki do social media
            updateSocialLinks("https://www.instagram.com/zanariwood/", "https://www.facebook.com/profile.php?id=61582568185533");

            // Dodaj event listenery dla aktywnych przycisków outlet
            document.querySelectorAll('.btn-outlet:not(:disabled)').forEach(btn => {
                const productName = btn.closest('.item').querySelector('h3').textContent;
                btn.addEventListener('click', function() {
                    openOutletModal(productName, this);
                });
            });

            // Modyfikuj przyciski zamówienia aby przekazywały element
            document.querySelectorAll('.btn-small:not(.btn-outlet)').forEach(btn => {
                const originalOnclick = btn.getAttribute('onclick');
                if (originalOnclick && originalOnclick.includes('openOrderModal')) {
                    btn.removeAttribute('onclick');
                    btn.addEventListener('click', function() {
                        const productName = this.closest('.item').querySelector('h3').textContent;
                        openOrderModal(productName, this);
                    });
                }
            });
        });
    </script>
</body>
</html>
